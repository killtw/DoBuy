<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Db_model extends CI_Model {	function __construct()	{		parent::__construct();	}// 分頁	function getdeals($num, $offset, $by, $order)	{		$query['rows'] = $this->db->where('endtime > now()')			->limit($num, $offset)			->order_by($by, $order)			->get('deals');		$query['num_rows'] = $this->db->where('endtime > now()')			->count_all_results('deals');		return $query;	}	function getcity($city, $num = 5, $offset = 0)	{		$query['rows'] = $this->db->where('city', $city)			->where('endtime > now()')			->limit($num, $offset)			->order_by('id', 'asc')			->get('deals');		$query['num_rows'] = $this->db->where('city', $city)			->where('endtime > now()')			->count_all_results('deals');		return $query;	}	function getcategory($category, $num = 5, $offset = 0)	{		$query['rows'] = $this->db->like('category', $category)			->where('endtime > now()')			->limit($num, $offset)			->order_by('id', 'asc')			->get('deals');		$query['num_rows'] = $this->db->like('category', $category)			->where('endtime > now()')			->count_all_results('deals');		return $query;	}	function getmaildeals($num, $by, $order, $like)	{		return $query = $this->db->where('endtime > now()')			->where('category', $like)			->limit($num, 0)			->order_by($by, $order)			->get('deals');	}	function getusers($num, $offset)	{		$query['rows'] = $this->db->limit($num, $offset)			->order_by('id', 'asc')			->get('users');		$query['num_rows'] = $this->db->count_all_results('users');		return $query;	}	function getid($db, $by, $id)	{		$query = $this->db->where($by, $id)			->get($db);		if(!empty($query->num_rows)) {			return $query->row();		}	}	function getwhere($db, $data)	{		return $query = $this->db->where($data)			->get($db);	}	function getdeal($id)	{		return $query = $this->db->where('id', $id)			->get('deals');	}	function getsearch($term)	{		return $query = $this->db->like('title', $term)			->where('endtime > now()')			->get('deals');	}	function getmails()	{		return $query = $this->db->where('sub', 1)		->get('users');	}		function webselect($url)	{		switch(true)		{			case(preg_match("/gomaji/si", $url)):				$site = 'GOJAMI';				break;			case(preg_match("/groupon/si", $url)):				$site = 'GRUOPON';				break;			case(preg_match("/yam/si", $url)):				$site = 'yam揪團購';				break;			case(preg_match("/17life/si", $url)):				$site = '17life';				break;			case(preg_match("/17shopping/si", $url)):				$site = '17shopping';				break;			case(preg_match("/lashou/si", $url)):				$site = '拉手網';				break;			case(preg_match("/123/si", $url)):				$site = '123團購網';				break;		}		return $site;	}// 地區分類	function city($address)	{		switch(true)		{			case (preg_match("/台北|臺北|新北/si", $address)):				$city = 'Taipei';				break;			case (preg_match("/台中|臺中/si", $address)):				$city = 'Taichung';				break;			case (preg_match("/台南|臺南/si", $address)):				$city = 'Tainan';				break;			case (preg_match("/高雄/si", $address)):				$city = 'Kaohsiung';				break;			case (preg_match("/基隆/si", $address)):				$city = 'Keelung';				break;			case (preg_match("/新竹/si", $address)):				$city = 'Hsinchu';				break;			case (preg_match("/嘉義/si", $address)):				$city = 'Chiayi';				break;			case (preg_match("/桃園/si", $address)):				$city = 'Taoyuan';				break;			case (preg_match("/苗栗/si", $address)):				$city = 'Miaoli';				break;			case (preg_match("/彰化/si", $address)):				$city = 'Changhua';				break;			case (preg_match("/南投/si", $address)):				$city = 'Nantou';				break;			case (preg_match("/雲林/si", $address)):				$city = 'Yunlin';				break;			case (preg_match("/屏東/si", $address)):				$city = 'Pingtung';				break;			case (preg_match("/宜蘭/si", $address)):				$city = 'Yilan';				break;			case (preg_match("/花蓮/si", $address)):				$city = 'Hualien';				break;			case (preg_match("/臺東|台東/si", $address)):				$city = 'Taitung';				break;			default:				$city = 'Other';				break;		}		return $city;	}	function category($title)	{		$category = 'Other';		if(preg_match("/T恤|襯衫|背心|小可愛|有領|POLO衫|休閒衫|毛衣|外套|上衣|裙子|褲子|洋裝|套裝|禮服|晚宴服|內衣|內褲|睡衣|胸墊|胸貼|肩帶|束衣|肚兜|襯衣|襯裙|首飾|皮帶|腰帶|帽子|手套|絲巾|圍巾|髮飾|皮夾|襪子|飾品|別針|胸花|吊飾|童裝|洋裝|牛仔褲|布料|皮革|繡花|套頭|外套|背心|日韓風|短袖|連衣裙|西裝|熱褲|泳裝|手鐲|款式|毛帽/si", $title)) {			$category = 'Clothing';		}		if(preg_match("/彩妝|化妝|保養|肌膚|皮膚|護髮|美髮|按摩|美容|沙龍|SPA|美白|睫毛|指甲|護理|紓壓|保溼|毛孔|氣色|角質|眼線|珍珠|防曬|美甲|清潔|塑身|香水|美體|精油|薰香|減肥|瘦身|乳液|乳霜|護唇|凝膠|輕盈|護手|美腿|保溼|豐胸|瀏海|面膜|舒壓|維他命|蜆錠|膚質|緊緻/si", $title)) {			if($category != 'Other') {				$category .= ', Beauty';			} else {				$category = 'Beauty';			}		}		if(preg_match("/飯店|住宿|自由行|酒店|名勝|古蹟|觀光|賞鳥|賞鯨|遊艇|浮潛|自由行|一日遊|機票|訂房|民宿|農場|行程|牧場|風景|景點|海水浴場|老街|國家公園|自然|單車|環遊|旅行社|航空|郵輪|高鐵|密月|渡假|度假/si", $title)) {			if($category != 'Other') {				$category .= ', Travel';			} else {				$category = 'Travel';			}		}		if(preg_match("/牛肉|泡菜|豬肉|雞肉|套餐|火鍋|魚|啤酒|咖啡|沙拉|焗烤|佳餚|冰品|蛋糕|甜點|鐵板燒|起司|披薩|壽司|美食|料理|冰淇淋|餅乾|口感|薯條|薯餅|餃|麵包|蔬菜|有機|茶飲|紅茶|奶茶|烏龍茶|綠茶|果汁|蝦球|炸蝦|鮮蝦|蛋糕|糕餅|滷味|巧克力|優格|草莓|鳳梨|黑糖|梅子|排骨|鹽烤|干貝|燒烤|燒肉|烘烤|水果|布丁|奶酪|青菜|葡萄|白飯|美味|饗宴|定食|芒果|蜜桃|茶葉|烘培|茶包|杏仁|玉米|抹茶|甘醇|即溶|拿鐵|奶精|肉質|爆米花|自助餐|仙草|pizza|餐點|buffet|涼麵|炸醬|岩鹽|安格斯|牛排|松露|壽喜燒|吃到飽|寒天|Cafe|文旦|煎餅|晚餐|主菜/si", $title)) {			if($category != 'Other') {				$category .= ', Diet';			} else {				$category = 'Diet';			}		}		return $category;	}// 資料庫寫入/刪除	function deal_insert($db, $data)	{		$this->db->insert($db, $data);		return;	}	function deal_delete()	{		$this->db->where('endtime < now()')			->delete('deals');		return;	}	function db_updata($db, $by, $id, $input)	{		$this->db->where($by, $id)			->update($db, $input);		return;	}	function check_insert($db, $row, $data)	{		$query = $this->db->where($row)			->get($db);		if(empty($query->num_rows)) $this->db->insert($db, $data);		return;	}}